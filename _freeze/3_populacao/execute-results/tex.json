{
  "hash": "aec57df3d22f8a65258be7c58b5c1d1d",
  "result": {
    "markdown": "# Dados de população e socioeconômicos\n\n## Download dos dados\n\n\nPara fazer o download dos dados do projeto AOP usando o pacote aopdata, você pode usar a função `read_population()`. Essa função baixa estimativas do Censo Demográfico de 2010 do IBGE sobre a distribuição espacial da população e suas características em termos de renda domiciliar per capita, cor, sexo e idade. Nesta função, o parâmetro `city` permite você indicar os dados de qual cidade serão baixados. \n\nOs dados estão agregados espacialmente em uma grade de [hexágonos H3](https://h3geo.org/) na resolução 9, na qual cada hexágono tem uma área de 0.11 km2, o que equivale a aproximadamente o tamanho de um quarteirão. Para baixar os dados com as informações espaciais de geometria da grade espacial, você deve usar o parâmetro `geometry = TRUE`. \n\nNeste exemplo, abaixo, nós mostramos como baixar os dados de população do Censo de 2010 para Fortaleza.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load libraries\nlibrary(aopdata)\n\n# download aop population data\ndf <- read_population(city='Fortaleza',\n                      year=2010,\n                      geometry = TRUE,\n                      showProgress = FALSE)\n```\n:::\n\n\n\nOs dados da tabela tem essa aparência aqui:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSimple feature collection with 6 features and 22 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: -38.50828 ymin: -3.889301 xmax: -38.4983 ymax: -3.878958\nGeodetic CRS:  WGS 84\n  year          id_hex abbrev_muni name_muni code_muni P001 P002 P003 P004 P005\n1 2010 89801040323ffff         for Fortaleza   2304400   30    8   21    0    1\n2 2010 89801040327ffff         for Fortaleza   2304400  318   77  233    0    8\n3 2010 8980104032bffff         for Fortaleza   2304400    0    0    0    0    0\n4 2010 8980104032fffff         for Fortaleza   2304400  103   24   77    0    2\n5 2010 89801040333ffff         for Fortaleza   2304400   43   11   31    0    1\n6 2010 89801040337ffff         for Fortaleza   2304400  348   86  252    0   10\n  P006 P007 P010 P011 P012 P013 P014 P015 P016  R001 R002 R003\n1   17   13    3    4    2    3    8    9    1 168.6    1    1\n2  168  150   30   50   26   38   80   82   12 202.6    1    1\n3    0    0    0    0    0    0    0    0    0    NA   NA   NA\n4   53   50   10   16    8   13   25   27    4 245.6    1    1\n5   22   21    4    7    3    5   11   12    1 187.3    1    1\n6  175  173   34   54   27   41   89   89   14 168.6    1    1\n                        geometry\n1 POLYGON ((-38.50232 -3.8858...\n2 POLYGON ((-38.50527 -3.8840...\n3 POLYGON ((-38.49932 -3.8841...\n4 POLYGON ((-38.50227 -3.8824...\n5 POLYGON ((-38.50237 -3.8893...\n6 POLYGON ((-38.50532 -3.8875...\n```\n:::\n:::\n\n\n\nDe imediato, se nota que os nomes das variáveis (colunas) da base de dados estão organizadas com códigos, como P001, P002…R001, R002 etc. A [descrição completa do dicionário de variáveis está disponível aqui](https://ipeagit.github.io/aopdata/articles/data_dic_pt.html). A descrição de algumas dessas colunas é apresentada nas próximas seções, onde mostramos como fazer a visualização de alguns desses dados em mapas e gráficos.\n\n\n\n## Mapa de população total\n\nAntes de visualizar os dados do `aopdata`, nós precisamos carregar algumas bibliotecas de visualização e manipulação de dados.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load libraries\nlibrary(patchwork)\nlibrary(ggplot2)\nlibrary(scales)\nlibrary(sf)\n```\n:::\n\n\n\nCom um comando, é possível visualizar a distribuição espacial da população de Fortaleza. A figura mostra um mapa coroplético onde a cor de cada célula da grade espacial é preenchida com base na quantidade total de pessoas residentes (variável `P001`).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data=subset(df, P001>0), aes(fill=P001), color=NA, alpha=.8) +\n  scale_fill_distiller(palette = \"YlOrRd\", direction = 1)+\n  labs(title='Population distribution', \n       subtitle = 'Fortaleza', fill=\"Total population\") +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](3_populacao_files/figure-pdf/plot population-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n## Mapa de população por cor\n\nAlém da informação sobre a população total em cada célula, o dados do `aopdata` também permitem saber a quantidade de pessoas de diferentes cores (variáveis `P002` a `P005`), sexo (variáveis `P006` e `P007`) e faixas etárias (variáveis `P010` à `P016`). O código abaixo ilustra como é simples calcular a proporção de pessoas negras e brancas em cada hexágono e visualizar esses dados num mapa.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npop_b <- ggplot() +\n  geom_sf(data=subset(df, P001 >0), aes(fill=P003 / P001), color=NA, alpha=.8) +\n  scale_fill_distiller(palette = \"RdPu\", direction = 1, labels = percent, limits=c(0, 1))+\n  labs(title='Proportion of black population', fill=\"Black pop.\") +\n  theme_void()\n\npop_w <- ggplot() +\n  geom_sf(data=subset(df, P001 >0), aes(fill=P002 / P001), color=NA, alpha=.8) +\n  scale_fill_distiller(palette = \"YlGnBu\", direction = 1, labels = percent, limits=c(0, 1))+\n  labs(title='Proportion of white population', fill=\"White pop.\") +\n  theme_void()\n\n# plot figure\npop_b + pop_w\n```\n\n::: {.cell-output-display}\n![](3_populacao_files/figure-pdf/plot race-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n## Mapa de população por renda\n\nOs dados trazem também informação sobre a renda domiciliar per capita média de cada hexágono (`R001`), e sua classificação em termos de quintil (`R002`) e decil de renda (`R003`). Com esses dados, é possível visualizar com o comando abaixo a distribuição espacial dos diferentes níveis de renda da cidade.R\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrenda_c <- ggplot() +\n  geom_sf(data=subset(df, P001 >0), aes(fill=R001), color=NA, alpha=.8) +\n  scale_fill_distiller(palette = \"YlOrRd\", direction = 1)+\n  labs(title='Renda domiciliar per capita média', fill=\"Renda em R$\") +\n  theme_void()\n\nrenda_d <- ggplot() +\n  geom_sf(data=subset(df, !is.na(R002)), aes(fill=factor(R003)), color=NA, alpha=.8) +\n  scale_fill_brewer(palette = \"RdBu\") +\n  labs(title='Decils de renda domiciliar per capita', fill=\"Decil de renda\") +\n  theme_void() +\n  theme(legend.key.size = unit(.3, 'cm'))\n\n# plot figure\nrenda_c + renda_d\n```\n\n::: {.cell-output-display}\n![](3_populacao_files/figure-pdf/plot income-1.pdf){fig-pos='H'}\n:::\n:::\n",
    "supporting": [
      "3_populacao_files\\figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}